{"ast":null,"code":"'use strict';\n\nif (typeof window == 'undefined') {\n  // node.js, load compat libraries\n  var DOMParser = require('xmldom').DOMParser;\n\n  var XMLSerializer = require('xmldom').XMLSerializer;\n\n  var text_encoding = require('text-encoding');\n\n  var TextEncoder = text_encoding.TextEncoder;\n  var TextDecoder = text_encoding.TextDecoder;\n  console.log(\"testX\");\n  console.log(TextDecoder);\n\n  var pako = require('pako');\n}\n\nfunction pdfform(minipdf_lib) {\n  if (minipdf_lib === 'pdf.js') {\n    minipdf_lib = require('./minipdf_js.js');\n  }\n\n  if (!minipdf_lib) {\n    // autodetct which library to use\n    if (typeof minipdf_js != 'undefined') {\n      minipdf_lib = minipdf_js;\n    } else if (typeof minipdf != 'undefined') {\n      minipdf_lib = minipdf;\n    } else {\n      minipdf_lib = require('./minipdf.js');\n    }\n  }\n\n  var assert = minipdf_lib.assert;\n\n  function BytesIO() {\n    this.length = 0;\n    this.entries = [];\n  }\n\n  BytesIO.prototype = {\n    write_str: function (s) {\n      this.length += s.length;\n      assert(typeof s == 'string');\n      this.entries.push(s);\n    },\n    write_buf: function (buf) {\n      this.length += buf.length;\n      assert(buf instanceof Uint8Array, 'Expected a Uint8Array, but got ' + buf);\n      this.entries.push(buf);\n    },\n    get_uint8array: function () {\n      var res = new Uint8Array(this.length);\n      var pos = 0;\n      this.entries.forEach(function (e) {\n        if (typeof e == 'string') {\n          for (var i = 0, slen = e.length; i < slen; i++, pos++) {\n            res[pos] = e.charCodeAt(i);\n          }\n        } else {\n          res.set(e, pos);\n          pos += e.length;\n        }\n      });\n      assert(pos === this.length);\n      return res;\n    },\n    position: function () {\n      return this.length;\n    }\n  };\n\n  function pad(num, length) {\n    var ret = num + '';\n\n    while (ret.length < length) {\n      ret = '0' + ret;\n    }\n\n    return ret;\n  }\n\n  function serialize_str(str) {\n    var ret, i; // simple chars, use plaintext\n\n    if (/^[-_/. a-zA-Z0-9]+$/.test(str)) {\n      return '(' + str + ')';\n    } // Only ASCII and some common ANSI chars\n\n\n    if (/^[\\x00-\\x7FäöüÄÖÜß]*$/.test(str)) {\n      // eslint-disable-line no-control-regex\n      ret = '(';\n\n      for (i = 0; i < str.length; i++) {\n        var c = str[i];\n\n        if (c === '\\\\' || c === '(' || c === ')') {\n          ret += '\\\\';\n        }\n\n        ret += c;\n      }\n\n      ret += ')';\n      return ret;\n    } // Unicode\n\n\n    ret = '(';\n    ret += '\\u00fe\\u00ff';\n\n    for (i = 0; i < str.length; i++) {\n      var cu = str.charCodeAt(i);\n      var c1 = String.fromCharCode(cu >> 8);\n\n      if (c1 === '\\\\' || c1 === '(' || c1 === ')') {\n        ret += '\\\\';\n      }\n\n      ret += c1;\n      var c2 = String.fromCharCode(cu & 0xff);\n\n      if (c2 === '\\\\' || c2 === '(' || c2 === ')') {\n        ret += '\\\\';\n      }\n\n      ret += c2;\n    }\n\n    ret += ')';\n    return ret;\n  }\n\n  function serialize(node, uncompressed) {\n    var i, ret; // Wishing for let in modern browsers :(\n\n    if (minipdf_lib.isRef(node)) {\n      return node.num + ' ' + node.gen + ' R';\n    } else if (minipdf_lib.isNum(node)) {\n      return node;\n    } else if (minipdf_lib.isBool(node)) {\n      return node;\n    } else if (minipdf_lib.isNull(node)) {\n      return 'null';\n    } else if (minipdf_lib.isName(node)) {\n      assert(node.name);\n      return '/' + node.name;\n    } else if (minipdf_lib.isString(node)) {\n      return serialize_str(node);\n    } else if (minipdf_lib.isArray(node)) {\n      ret = ['['];\n\n      for (i = 0; i < node.length; i++) {\n        ret.push(serialize(node[i], uncompressed));\n      }\n\n      ret.push(']');\n      return ret.join(' ');\n    } else if (minipdf_lib.isDict(node)) {\n      var map = node.map;\n      ret = ['<<'];\n\n      for (var key in map) {\n        ret.push('/' + key + ' ' + serialize(map[key], uncompressed));\n      }\n\n      ret.push('>>');\n      return ret.join('\\n');\n    } else if (minipdf_lib.isStream(node)) {\n      ret = '';\n      delete node.dict.map.DecodeParms;\n      delete node.dict.map.Filter;\n      var content = node.getBytes();\n      assert(content, 'expecting byte content from ' + JSON.stringify(node));\n      var out;\n\n      if (uncompressed) {\n        out = minipdf_lib.buf2str(content);\n        node.dict.map.Length = out.length;\n      } else {\n        out = minipdf_lib.buf2str(pako.deflate(content));\n        node.dict.map.Length = out.length;\n        node.dict.map.Filter = [new minipdf_lib.Name('FlateDecode')];\n      }\n\n      assert(minipdf_lib.isDict(node.dict));\n      ret += serialize(node.dict, uncompressed);\n      ret += '\\nstream\\n';\n      ret += out;\n      ret += '\\nendstream\\n';\n      return ret;\n    } else {\n      throw new Error('Unknown node type ' + JSON.stringify(node));\n    }\n  }\n\n  function PDFObjects(doc) {\n    this.entries = doc.get_xref_entries();\n    assert(minipdf_lib.isArray(this.entries), 'xref entries should be an Array');\n  }\n\n  PDFObjects.prototype = {\n    add: function (obj, gen) {\n      var e = {\n        obj: obj,\n        gen: gen,\n        num: this.entries.length,\n        uncompressed: 'added'\n      };\n      this.entries.push(e);\n      return e;\n    },\n    update: function (ref, obj) {\n      assert(ref.num !== undefined);\n      assert(ref.gen !== undefined);\n      var e = {\n        obj: obj,\n        gen: ref.gen,\n        num: ref.num,\n        uncompressed: 'added'\n      };\n      this.entries[e.num] = e;\n      return e;\n    },\n    write_object: function (out, e, uncompressed) {\n      e.offset = out.position();\n      assert(e.num !== undefined);\n      var bs = serialize(e.obj, uncompressed);\n      out.write_str(e.num + ' ' + e.gen + ' obj\\n');\n      out.write_str(bs);\n      out.write_str('\\nendobj\\n');\n    },\n    write_xref_stream: function (out, prev, root_ref) {\n      var map = {\n        Type: new minipdf_lib.Name('XRef'),\n        Size: this.entries.length + 1,\n        // + 1 for this object itself\n        Root: root_ref,\n        W: [1, 4, 1],\n        Index: []\n      };\n\n      if (prev !== undefined) {\n        map.Prev = prev;\n      }\n\n      var total_count = 0;\n      var need_new_index = true;\n      var bio = new BytesIO();\n      var entry = this.add('__xref_stream__', 0);\n      entry.offset = out.position();\n      this.entries.forEach(function (e, idx) {\n        var is_new_entry = e.uncompressed === 'added';\n\n        if (!is_new_entry) {\n          need_new_index = true;\n          return;\n        }\n\n        total_count++;\n\n        if (need_new_index) {\n          need_new_index = false;\n          map.Index.push(idx);\n          map.Index.push(1);\n        } else {\n          map.Index[map.Index.length - 1]++;\n        }\n\n        assert(e.offset !== undefined, 'entry should have an offset');\n        bio.write_buf(new Uint8Array([e.uncompressed ? 1 : 2, e.offset >> 24, e.offset >> 16 & 0xff, e.offset >> 8 & 0xff, e.offset & 0xff, e.gen]));\n      });\n      var ui8ar = bio.get_uint8array();\n      map.Length = 6 * (total_count + 1);\n      var stream = minipdf_lib.newStream(map, ui8ar);\n      entry.obj = stream;\n      this.write_object(out, entry, true);\n    },\n    write_xref_table: function (out, prev, root_ref) {\n      var entries = this.entries.filter(function (e) {\n        return !e.is_free;\n      });\n      var size = 1 + entries.length;\n      out.write_str('xref\\n');\n      out.write_str('0 ' + size + '\\n');\n      out.write_str('0000000000 65535 f\\r\\n');\n      entries.forEach(function (e) {\n        assert(e.offset !== undefined, 'entry should have an offset');\n        out.write_str(pad(e.offset, 10) + ' ' + pad(e.gen, 5) + ' n\\r\\n');\n      }); // write trailer\n\n      out.write_str('trailer\\n');\n      var trailer = new minipdf_lib.Dict({\n        Size: size,\n        Root: root_ref\n      });\n      out.write_str(serialize(trailer, true));\n    }\n  };\n\n  function visit_acroform_fields(doc, callback) {\n    if (doc.acroForm) {\n      var to_visit = doc.acroForm.map.Fields.slice();\n\n      while (to_visit.length > 0) {\n        var n = to_visit.shift();\n\n        if (minipdf_lib.isRef(n)) {\n          var ref = n;\n          n = doc.fetch(n);\n          n._pdfform_ref = ref;\n        }\n\n        if (n.map && n.map.Kids && n.map.Opt && n.map.FT && n.map.FT.name === 'Btn') {\n          // Radio button\n          n._pdfform_spec = {\n            type: 'radio',\n            options: n.map.Opt\n          };\n          callback(n);\n        } else if (n.map && n.map.Kids) {\n          to_visit.push.apply(to_visit, n.map.Kids);\n        } else if (n.map && n.map.Type && n.map.Type.name == 'Annot' && n.map.T) {\n          callback(n);\n        }\n      }\n    } else {\n      // No AcroForm? Look in the pages themselves\n      var pages = doc.fetch(doc.root.map.Pages);\n      pages.map.Kids.forEach(function (page_ref) {\n        var page = doc.fetch(page_ref);\n        var annots_ref = page.map.Annots;\n        var annots = doc.fetch(annots_ref);\n        annots.forEach(function (annot_ref) {\n          var n = doc.fetch(annot_ref);\n          n._pdfform_ref = annot_ref;\n          n._inpage_annot = true;\n\n          if (n.map && n.map.Type && n.map.Type.name == 'Annot' && n.map.T) {\n            callback(n);\n          }\n        });\n      });\n    }\n  }\n\n  function pdf_decode_str(str) {\n    if (!str.startsWith('\\u00FE\\u00FF')) {\n      return str;\n    }\n\n    var res = '';\n\n    for (var i = 2; i < str.length; i += 2) {\n      res += String.fromCharCode(str.charCodeAt(i) << 8 | str.charCodeAt(i + 1));\n    }\n\n    return res;\n  }\n\n  function acroform_match_spec(n, fields) {\n    var t = pdf_decode_str(n.map.T);\n\n    if (t in fields) {\n      return fields[t][0];\n    } else {\n      var m = /^(.*)\\[([0-9]+)\\]$/.exec(t);\n\n      if (m && m[1] in fields) {\n        return fields[m[1]][m[2]];\n      }\n    }\n\n    return undefined;\n  }\n\n  function modify_xfa(doc, objects, out, index, callback) {\n    if (!doc.acroForm) {\n      return;\n    }\n\n    var xfa = doc.acroForm.map.XFA;\n\n    if (!xfa) {\n      return; // acroForm-only\n    }\n\n    var section_idx = xfa.indexOf(index);\n    assert(section_idx >= 0);\n    var section_ref = xfa[section_idx + 1];\n    var section_node = doc.fetch(section_ref);\n    assert(minipdf_lib.isStream(section_node), 'XFA section node should be a stream');\n    var bs = section_node.getBytes();\n    assert(bs);\n    console.log(\"test\");\n    console.log(TextDecoder);\n    var prev_str = new TextDecoder('utf-8').decode(bs);\n    var str = callback(prev_str);\n    var out_bs = new TextEncoder('utf-8').encode(str);\n    var out_node = minipdf_lib.newStream(section_node.dict.map, out_bs);\n    assert(minipdf_lib.isStream(out_node));\n    var e = objects.update(section_ref, out_node);\n    objects.write_object(out, e);\n  }\n\n  function transform(buf, fields) {\n    var doc = minipdf_lib.parse(new Uint8Array(buf));\n    assert(doc.startXRef);\n    var objects = new PDFObjects(doc);\n    var root_id = doc.get_root_id();\n    var root_ref = new minipdf_lib.Ref(root_id, 0);\n    var out = new BytesIO();\n    out.write_buf(new Uint8Array(buf)); // Change AcroForms\n\n    visit_acroform_fields(doc, function (n) {\n      var value = acroform_match_spec(n, fields);\n\n      if (value === undefined) {\n        return;\n      }\n\n      if (n._pdfform_spec) {\n        var type = n._pdfform_spec.type;\n\n        if (type === 'radio') {\n          var idx = n._pdfform_spec.options.indexOf(value);\n\n          if (idx === -1) return;\n          var kid_ref = n.map.Kids[idx];\n\n          if (!kid_ref) {\n            throw new Error('Cannot find kid #' + idx + ' (value=' + value + ')');\n          }\n\n          if (!minipdf_lib.isRef(kid_ref)) {\n            throw new Error('radio kid is not a reference');\n          }\n\n          var kid = doc.fetch(kid_ref);\n          kid.map.AS = kid.map.V = kid.map.DV = new minipdf_lib.Name('Yes');\n          var kid_entry = objects.update(kid_ref, kid);\n          objects.write_object(out, kid_entry);\n          return;\n        } else {\n          throw new Error('Unsupported spec type ' + type);\n        }\n      } else {\n        var ft_name = n.map.FT.name;\n\n        if (ft_name == 'Tx') {\n          n.map.V = '' + value;\n        } else if (ft_name == 'Btn') {\n          n.map.AS = n.map.V = n.map.DV = value ? new minipdf_lib.Name('Yes') : new minipdf_lib.Name('Off');\n        } else if (ft_name == 'Ch') {\n          n.map.V = '' + value;\n        } else if (ft_name == 'Sig') {\n          return; // Signature fields are not supported so far\n        } else {\n          throw new Error('Unsupported input type ' + n.map.FT.name);\n        }\n      }\n\n      var ref = n._pdfform_ref;\n      var e = objects.update(ref, n);\n      objects.write_object(out, e);\n    });\n    var acroform_ref = doc.get_acroform_ref();\n\n    if (acroform_ref) {\n      // Acroform present\n      doc.acroForm.map.NeedAppearances = true;\n\n      if (minipdf_lib.isRef(acroform_ref)) {\n        // Replace just the AcroForm object\n        var e = objects.update(acroform_ref, doc.acroForm);\n        objects.write_object(out, e);\n      } else {\n        // Replace the entire root object\n        doc.root.map.AcroForm = doc.acroForm;\n        var root = objects.update(root_ref, doc.root);\n        objects.write_object(out, root);\n      }\n    } // Change XFA\n\n\n    modify_xfa(doc, objects, out, 'datasets', function (str) {\n      // Fix up XML\n      str = str.replace(/\\n(\\/?>)/g, '$1\\n');\n      var ds_doc = new DOMParser().parseFromString(str, 'application/xml');\n\n      for (var f in fields) {\n        var els = ds_doc.getElementsByTagName(f);\n\n        for (var i = 0; i < els.length; i++) {\n          var val = fields[f][i];\n\n          if (val === undefined) {\n            continue;\n          }\n\n          var el = els[i];\n\n          while (el.firstChild) {\n            el.removeChild(el.firstChild);\n          }\n\n          if (typeof val == 'boolean') {\n            val = val ? 1 : 0;\n          }\n\n          el.appendChild(ds_doc.createTextNode(val));\n        }\n      }\n\n      str = new XMLSerializer().serializeToString(ds_doc);\n      return str;\n    });\n    var startxref = out.position();\n\n    if (doc.xref_type === 'table') {\n      objects.write_xref_table(out, doc.startXRef, root_ref);\n    } else {\n      objects.write_xref_stream(out, doc.startXRef, root_ref);\n    }\n\n    out.write_str('\\nstartxref\\n');\n    out.write_str(startxref + '\\n');\n    out.write_str('%%EOF');\n    return out.get_uint8array();\n  }\n\n  function list_fields(data) {\n    var doc = minipdf_lib.parse(new Uint8Array(data));\n    var res = {};\n    visit_acroform_fields(doc, function (n) {\n      var raw_name = pdf_decode_str(n.map.T);\n      var name = raw_name;\n      var index = 0;\n      var m = /^(.+?)\\[([0-9]+)\\]$/.exec(raw_name);\n\n      if (m) {\n        name = m[1];\n        index = parseInt(m[2], 10);\n      }\n\n      var spec;\n\n      if (n._pdfform_spec) {\n        spec = n._pdfform_spec;\n      } else {\n        var ft_name = n.map.FT.name;\n\n        if (ft_name === 'Tx') {\n          spec = {\n            type: 'string'\n          };\n        } else if (ft_name === 'Btn') {\n          spec = {\n            type: 'boolean'\n          };\n        } else if (ft_name === 'Ch') {\n          spec = {\n            type: 'select',\n            options: n.map.Opt.slice()\n          };\n        } else if (ft_name === 'Sig') {\n          return; // Signature names are not supported so far\n        } else {\n          throw new Error('Unsupported input type' + ft_name);\n        }\n      }\n\n      if (!res[name]) {\n        res[name] = [];\n      }\n\n      res[name][index] = spec;\n    });\n    return res;\n  }\n\n  return {\n    transform: transform,\n    list_fields: list_fields,\n    // test only\n    _serialize_str: serialize_str,\n    _decode_str: pdf_decode_str\n  };\n} // Backwards compatibility only\n\n\npdfform.transform = function (buf, fields) {\n  return pdfform().transform(buf, fields);\n};\n\nif (typeof module != 'undefined') {\n  module.exports = pdfform;\n}","map":{"version":3,"sources":["/Users/Shared/Previously Relocated Items/Security/development/react/wizard/node_modules/pdfform.js/pdfform.js"],"names":["window","DOMParser","require","XMLSerializer","text_encoding","TextEncoder","TextDecoder","console","log","pako","pdfform","minipdf_lib","minipdf_js","minipdf","assert","BytesIO","length","entries","prototype","write_str","s","push","write_buf","buf","Uint8Array","get_uint8array","res","pos","forEach","e","i","slen","charCodeAt","set","position","pad","num","ret","serialize_str","str","test","c","cu","c1","String","fromCharCode","c2","serialize","node","uncompressed","isRef","gen","isNum","isBool","isNull","isName","name","isString","isArray","join","isDict","map","key","isStream","dict","DecodeParms","Filter","content","getBytes","JSON","stringify","out","buf2str","Length","deflate","Name","Error","PDFObjects","doc","get_xref_entries","add","obj","update","ref","undefined","write_object","offset","bs","write_xref_stream","prev","root_ref","Type","Size","Root","W","Index","Prev","total_count","need_new_index","bio","entry","idx","is_new_entry","ui8ar","stream","newStream","write_xref_table","filter","is_free","size","trailer","Dict","visit_acroform_fields","callback","acroForm","to_visit","Fields","slice","n","shift","fetch","_pdfform_ref","Kids","Opt","FT","_pdfform_spec","type","options","apply","T","pages","root","Pages","page_ref","page","annots_ref","Annots","annots","annot_ref","_inpage_annot","pdf_decode_str","startsWith","acroform_match_spec","fields","t","m","exec","modify_xfa","objects","index","xfa","XFA","section_idx","indexOf","section_ref","section_node","prev_str","decode","out_bs","encode","out_node","transform","parse","startXRef","root_id","get_root_id","Ref","value","kid_ref","kid","AS","V","DV","kid_entry","ft_name","acroform_ref","get_acroform_ref","NeedAppearances","AcroForm","replace","ds_doc","parseFromString","f","els","getElementsByTagName","val","el","firstChild","removeChild","appendChild","createTextNode","serializeToString","startxref","xref_type","list_fields","data","raw_name","parseInt","spec","_serialize_str","_decode_str","module","exports"],"mappings":"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","sourcesContent":["'use strict';\n\nif (typeof window == 'undefined') {\n\t// node.js, load compat libraries\n\tvar DOMParser = require('xmldom').DOMParser;\n\tvar XMLSerializer = require('xmldom').XMLSerializer;\n\tvar text_encoding = require('text-encoding');\n\tvar TextEncoder = text_encoding.TextEncoder;\n\tvar TextDecoder = text_encoding.TextDecoder;\n\n\tconsole.log(\"testX\")\n\tconsole.log(TextDecoder)\n\n\tvar pako = require('pako');\n}\n\nfunction pdfform(minipdf_lib) {\n\nif (minipdf_lib === 'pdf.js') {\n\tminipdf_lib = require('./minipdf_js.js');\n}\n\nif (! minipdf_lib) {\n\t// autodetct which library to use\n\tif (typeof minipdf_js != 'undefined') {\n\t\tminipdf_lib = minipdf_js;\n\t} else if (typeof minipdf != 'undefined') {\n\t\tminipdf_lib = minipdf;\n\t} else {\n\t\tminipdf_lib = require('./minipdf.js');\n\t}\n}\n\nvar assert = minipdf_lib.assert;\n\nfunction BytesIO() {\n\tthis.length = 0;\n\tthis.entries = [];\n}\nBytesIO.prototype = {\n\twrite_str: function(s) {\n\t\tthis.length += s.length;\n\t\tassert(typeof s == 'string');\n\t\tthis.entries.push(s);\n\t},\n\twrite_buf: function(buf) {\n\t\tthis.length += buf.length;\n\t\tassert(\n\t\t\tbuf instanceof Uint8Array,\n\t\t\t'Expected a Uint8Array, but got ' + buf);\n\t\tthis.entries.push(buf);\n\t},\n\tget_uint8array: function() {\n\t\tvar res = new Uint8Array(this.length);\n\t\tvar pos = 0;\n\t\tthis.entries.forEach(function(e) {\n\t\t\tif (typeof e == 'string') {\n\t\t\t\tfor (var i = 0,slen = e.length;i < slen;i++,pos++) {\n\t\t\t\t\tres[pos] = e.charCodeAt(i);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tres.set(e, pos);\n\t\t\t\tpos += e.length;\n\t\t\t}\n\t\t});\n\t\tassert(pos === this.length);\n\t\treturn res;\n\t},\n\tposition: function() {\n\t\treturn this.length;\n\t},\n};\n\n\nfunction pad(num, length) {\n\tvar ret = num + '';\n\twhile (ret.length < length) {\n\t\tret = '0' + ret;\n\t}\n\treturn ret;\n}\n\nfunction serialize_str(str) {\n\tvar ret, i;\n\n\t// simple chars, use plaintext\n\tif (/^[-_/. a-zA-Z0-9]+$/.test(str)) {\n\t\treturn '(' + str + ')';\n\t}\n\n\t// Only ASCII and some common ANSI chars\n\tif (/^[\\x00-\\x7FäöüÄÖÜß]*$/.test(str)) { // eslint-disable-line no-control-regex\n\t\tret = '(';\n\t\tfor (i = 0; i < str.length; i++) {\n\t\t\tvar c = str[i];\n\t\t\tif (c === '\\\\' || c === '(' || c === ')') {\n\t\t\t\tret += '\\\\';\n\t\t\t}\n\t\t\tret += c;\n\t\t}\n\t\tret += ')';\n\t\treturn ret;\n\t}\n\n\t// Unicode\n\tret = '(';\n\tret += '\\u00fe\\u00ff';\n\tfor (i = 0; i < str.length; i++) {\n\t\tvar cu = str.charCodeAt(i);\n\t\tvar c1 = String.fromCharCode(cu >> 8);\n\t\tif (c1 === '\\\\' || c1 === '(' || c1 === ')') {\n\t\t\tret += '\\\\';\n\t\t}\n\t\tret += c1;\n\t\tvar c2 = String.fromCharCode(cu & 0xff);\n\t\tif (c2 === '\\\\' || c2 === '(' || c2 === ')') {\n\t\t\tret += '\\\\';\n\t\t}\n\t\tret += c2;\n\t}\n\tret += ')';\n\treturn ret;\n}\n\nfunction serialize(node, uncompressed) {\n\tvar i, ret;  // Wishing for let in modern browsers :(\n\tif (minipdf_lib.isRef(node)) {\n\t\treturn node.num + ' ' + node.gen + ' R';\n\t} else if (minipdf_lib.isNum(node)) {\n\t\treturn node;\n\t} else if (minipdf_lib.isBool(node)) {\n\t\treturn node;\n\t} else if (minipdf_lib.isNull(node)) {\n\t\treturn 'null';\n\t} else if (minipdf_lib.isName(node)) {\n\t\tassert(node.name);\n\t\treturn '/' + node.name;\n\t} else if (minipdf_lib.isString(node)) {\n\t\treturn serialize_str(node);\n\t} else if (minipdf_lib.isArray(node)) {\n\t\tret = ['['];\n\t\tfor (i = 0; i < node.length; i++) {\n\t\t\tret.push(serialize(node[i], uncompressed));\n\t\t}\n\t\tret.push(']');\n\t\treturn ret.join(' ');\n\t} else if (minipdf_lib.isDict(node)) {\n\t\tvar map = node.map;\n\t\tret = ['<<'];\n\t\tfor (var key in map) {\n\t\t\tret.push('/' + key + ' ' + serialize(map[key], uncompressed));\n\t\t}\n\t\tret.push('>>');\n\t\treturn ret.join('\\n');\n\t} else if (minipdf_lib.isStream(node)) {\n\t\tret = '';\n\t\tdelete node.dict.map.DecodeParms;\n\t\tdelete node.dict.map.Filter;\n\n\t\tvar content = node.getBytes();\n\t\tassert(content, 'expecting byte content from ' + JSON.stringify(node));\n\t\tvar out;\n\t\tif (uncompressed) {\n\t\t\tout = minipdf_lib.buf2str(content);\n\t\t\tnode.dict.map.Length = out.length;\n\t\t} else {\n\t\t\tout = minipdf_lib.buf2str(pako.deflate(content));\n\t\t\tnode.dict.map.Length = out.length;\n\t\t\tnode.dict.map.Filter = [new minipdf_lib.Name('FlateDecode')];\n\t\t}\n\n\t\tassert(minipdf_lib.isDict(node.dict));\n\t\tret += serialize(node.dict, uncompressed);\n\t\tret += '\\nstream\\n';\n\t\tret += out;\n\t\tret += '\\nendstream\\n';\n\t\treturn ret;\n\t} else {\n\t\tthrow new Error('Unknown node type ' + JSON.stringify(node));\n\t}\n  }\n\nfunction PDFObjects(doc) {\n\tthis.entries = doc.get_xref_entries();\n\tassert(minipdf_lib.isArray(this.entries), 'xref entries should be an Array');\n}\nPDFObjects.prototype = {\nadd: function(obj, gen) {\n\tvar e = {\n\t\tobj: obj,\n\t\tgen: gen,\n\t\tnum: this.entries.length,\n\t\tuncompressed: 'added',\n\t};\n\tthis.entries.push(e);\n\treturn e;\n},\nupdate: function(ref, obj) {\n\tassert(ref.num !== undefined);\n\tassert(ref.gen !== undefined);\n\tvar e = {\n\t\tobj: obj,\n\t\tgen: ref.gen,\n\t\tnum: ref.num,\n\t\tuncompressed: 'added',\n\t};\n\tthis.entries[e.num] = e;\n\treturn e;\n},\nwrite_object: function(out, e, uncompressed) {\n\te.offset = out.position();\n\tassert(e.num !== undefined);\n\tvar bs = serialize(e.obj, uncompressed);\n\tout.write_str(e.num + ' ' + e.gen + ' obj\\n');\n\tout.write_str(bs);\n\tout.write_str('\\nendobj\\n');\n},\nwrite_xref_stream: function(out, prev, root_ref) {\n\tvar map = {\n\t\tType: new minipdf_lib.Name('XRef'),\n\t\tSize: this.entries.length + 1, // + 1 for this object itself\n\t\tRoot: root_ref,\n\t\tW: [1, 4, 1],\n\t\tIndex: [],\n\t};\n\tif (prev !== undefined) {\n\t\tmap.Prev = prev;\n\t}\n\n\tvar total_count = 0;\n\tvar need_new_index = true;\n\tvar bio = new BytesIO();\n\tvar entry = this.add('__xref_stream__', 0);\n\tentry.offset = out.position();\n\tthis.entries.forEach(function(e, idx) {\n\t\tvar is_new_entry = e.uncompressed === 'added';\n\t\tif (!is_new_entry) {\n\t\t\tneed_new_index = true;\n\t\t\treturn;\n\t\t}\n\n\t\ttotal_count++;\n\t\tif (need_new_index) {\n\t\t\tneed_new_index = false;\n\t\t\tmap.Index.push(idx);\n\t\t\tmap.Index.push(1);\n\t\t} else {\n\t\t\tmap.Index[map.Index.length - 1]++;\n\t\t}\n\n\t\tassert(e.offset !== undefined, 'entry should have an offset');\n\t\tbio.write_buf(new Uint8Array([\n\t\t\t(e.uncompressed ? 1 : 2),\n\t\t\t(e.offset >> 24),\n\t\t\t(e.offset >> 16) & 0xff,\n\t\t\t(e.offset >> 8) & 0xff,\n\t\t\te.offset & 0xff,\n\t\t\te.gen,\n\t\t]));\n\t});\n\tvar ui8ar = bio.get_uint8array();\n\n\tmap.Length = 6 * (total_count + 1);\n\n\tvar stream = minipdf_lib.newStream(map, ui8ar);\n\tentry.obj = stream;\n\tthis.write_object(out, entry, true);\n},\nwrite_xref_table: function(out, prev, root_ref) {\n\tvar entries = this.entries.filter(function(e) {\n\t\treturn !e.is_free;\n\t});\n\tvar size = 1 + entries.length;\n\tout.write_str('xref\\n');\n\tout.write_str('0 ' + size + '\\n');\n\tout.write_str('0000000000 65535 f\\r\\n');\n\tentries.forEach(function(e) {\n\t\tassert(e.offset !== undefined, 'entry should have an offset');\n\t\tout.write_str(pad(e.offset, 10) + ' ' + pad(e.gen, 5) + ' n\\r\\n');\n\t});\n\n\t// write trailer\n\tout.write_str('trailer\\n');\n\tvar trailer = new minipdf_lib.Dict({\n\t\tSize: size,\n\t\tRoot: root_ref,\n\t});\n\tout.write_str(serialize(trailer, true));\n},\n};\n\nfunction visit_acroform_fields(doc, callback) {\n\tif (doc.acroForm) {\n\t\tvar to_visit = doc.acroForm.map.Fields.slice();\n\t\twhile (to_visit.length > 0) {\n\t\t\tvar n = to_visit.shift();\n\t\t\tif (minipdf_lib.isRef(n)) {\n\t\t\t\tvar ref = n;\n\t\t\t\tn = doc.fetch(n);\n\t\t\t\tn._pdfform_ref = ref;\n\t\t\t}\n\n\t\t\tif (n.map && n.map.Kids && n.map.Opt && n.map.FT && (n.map.FT.name === 'Btn')) {\n\t\t\t\t// Radio button\n\t\t\t\tn._pdfform_spec = {\n\t\t\t\t\ttype: 'radio',\n\t\t\t\t\toptions: n.map.Opt,\n\t\t\t\t};\n\t\t\t\tcallback(n);\n\t\t\t} else if (n.map && n.map.Kids) {\n\t\t\t\tto_visit.push.apply(to_visit, n.map.Kids);\n\t\t\t} else if (n.map && n.map.Type && n.map.Type.name == 'Annot' && n.map.T) {\n\t\t\t\tcallback(n);\n\t\t\t}\n\t\t}\n\t} else {\n\t\t// No AcroForm? Look in the pages themselves\n\t\tvar pages = doc.fetch(doc.root.map.Pages);\n\t\tpages.map.Kids.forEach(function(page_ref) {\n\t\t\tvar page = doc.fetch(page_ref);\n\t\t\tvar annots_ref = page.map.Annots;\n\t\t\tvar annots = doc.fetch(annots_ref);\n\n\t\t\tannots.forEach(function(annot_ref) {\n\t\t\t\tvar n = doc.fetch(annot_ref);\n\t\t\t\tn._pdfform_ref = annot_ref;\n\t\t\t\tn._inpage_annot = true;\n\t\t\t\tif (n.map && n.map.Type && n.map.Type.name == 'Annot' && n.map.T) {\n\t\t\t\t\tcallback(n);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n}\n\nfunction pdf_decode_str(str) {\n\tif (! str.startsWith('\\u00FE\\u00FF')) {\n\t\treturn str;\n\t}\n\tvar res = '';\n\tfor (var i = 2; i < str.length; i += 2) {\n\t\tres += String.fromCharCode(str.charCodeAt(i) << 8 | str.charCodeAt(i + 1));\n\t}\n\treturn res;\n}\n\nfunction acroform_match_spec(n, fields) {\n\tvar t = pdf_decode_str(n.map.T);\n\tif (t in fields) {\n\t\treturn fields[t][0];\n\t} else {\n\t\tvar m = /^(.*)\\[([0-9]+)\\]$/.exec(t);\n\t\tif (m && (m[1] in fields)) {\n\t\t\treturn fields[m[1]][m[2]];\n\t\t}\n\t}\n\treturn undefined;\n}\n\n\nfunction modify_xfa(doc, objects, out, index, callback) {\n\tif (!doc.acroForm) {\n\t\treturn;\n\t}\n\tvar xfa = doc.acroForm.map.XFA;\n\tif (! xfa) {\n\t\treturn; // acroForm-only\n\t}\n\tvar section_idx = xfa.indexOf(index);\n\tassert(section_idx >= 0);\n\tvar section_ref = xfa[section_idx + 1];\n\tvar section_node = doc.fetch(section_ref);\n\tassert(minipdf_lib.isStream(section_node), 'XFA section node should be a stream');\n\tvar bs = section_node.getBytes();\n\tassert(bs);\n\tconsole.log(\"test\")\n\tconsole.log(TextDecoder)\n\tvar prev_str = (new TextDecoder('utf-8')).decode(bs);\n\n\tvar str = callback(prev_str);\n \n\tvar out_bs = (new TextEncoder('utf-8').encode(str));\n\tvar out_node = minipdf_lib.newStream(section_node.dict.map, out_bs);\n\tassert(minipdf_lib.isStream(out_node));\n\n\tvar e = objects.update(section_ref, out_node);\n\tobjects.write_object(out, e);\n}\n\nfunction transform(buf, fields) {\n\tvar doc = minipdf_lib.parse(new Uint8Array(buf));\n\tassert(doc.startXRef);\n\tvar objects = new PDFObjects(doc);\n\tvar root_id = doc.get_root_id();\n\tvar root_ref = new minipdf_lib.Ref(root_id, 0);\n\n\tvar out = new BytesIO();\n\tout.write_buf(new Uint8Array(buf));\n\n\t// Change AcroForms\n\tvisit_acroform_fields(doc, function(n) {\n\t\tvar value = acroform_match_spec(n, fields);\n\t\tif (value === undefined) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (n._pdfform_spec) {\n\t\t\tvar type = n._pdfform_spec.type;\n\t\t\tif (type === 'radio') {\n\t\t\t\tvar idx = n._pdfform_spec.options.indexOf(value);\n\t\t\t\tif (idx === -1) return;\n\n\t\t\t\tvar kid_ref = n.map.Kids[idx];\n\t\t\t\tif (!kid_ref) {\n\t\t\t\t\tthrow new Error('Cannot find kid #' + idx + ' (value=' + value + ')');\n\t\t\t\t}\n\t\t\t\tif (!minipdf_lib.isRef(kid_ref)) {\n\t\t\t\t\tthrow new Error('radio kid is not a reference');\n\t\t\t\t}\n\n\t\t\t\tvar kid = doc.fetch(kid_ref);\n\t\t\t\tkid.map.AS = kid.map.V = kid.map.DV = new minipdf_lib.Name('Yes');\n\n\t\t\t\tvar kid_entry = objects.update(kid_ref, kid);\n\t\t\t\tobjects.write_object(out, kid_entry);\n\t\t\t\treturn;\n\t\t\t} else {\n\t\t\t\tthrow new Error('Unsupported spec type ' + type);\n\t\t\t}\n\t\t} else {\n\t\t\tvar ft_name = n.map.FT.name;\n\t\t\tif (ft_name == 'Tx') {\n\t\t\t\tn.map.V = '' + value;\n\t\t\t} else if (ft_name == 'Btn') {\n\t\t\t\tn.map.AS = n.map.V = n.map.DV = value ? new minipdf_lib.Name('Yes') : new minipdf_lib.Name('Off');\n\t\t\t} else if (ft_name == 'Ch') {\n\t\t\t\tn.map.V =  '' + value;\n\t\t\t} else if (ft_name == 'Sig') {\n\t\t\t\treturn; // Signature fields are not supported so far\n\t\t\t} else {\n\t\t\t\tthrow new Error('Unsupported input type ' + n.map.FT.name);\n\t\t\t}\n\t\t}\n\n\t\tvar ref = n._pdfform_ref;\n\t\tvar e = objects.update(ref, n);\n\t\tobjects.write_object(out, e);\n\t});\n\n\tvar acroform_ref = doc.get_acroform_ref();\n\tif (acroform_ref) { // Acroform present\n\t\tdoc.acroForm.map.NeedAppearances = true;\n\t\tif (minipdf_lib.isRef(acroform_ref)) {\n\t\t\t// Replace just the AcroForm object\n\t\t\tvar e = objects.update(acroform_ref, doc.acroForm);\n\t\t\tobjects.write_object(out, e);\n\t\t} else {\n\t\t\t// Replace the entire root object\n\t\t\tdoc.root.map.AcroForm = doc.acroForm;\n\t\t\tvar root = objects.update(root_ref, doc.root);\n\t\t\tobjects.write_object(out, root);\n\t\t}\n\t}\n\n\t// Change XFA\n\tmodify_xfa(doc, objects, out, 'datasets', function(str) {\n\t\t// Fix up XML\n\t\tstr = str.replace(/\\n(\\/?>)/g, '$1\\n');\n\n\t\tvar ds_doc = new DOMParser().parseFromString(str, 'application/xml');\n\t\tfor (var f in fields) {\n\t\t\tvar els = ds_doc.getElementsByTagName(f);\n\n\t\t\tfor (var i = 0;i < els.length;i++) {\n\t\t\t\tvar val = fields[f][i];\n\t\t\t\tif (val === undefined) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tvar el = els[i];\n\t\t\t\twhile (el.firstChild) {\n\t\t\t\t\tel.removeChild(el.firstChild);\n\t\t\t\t}\n\n\t\t\t\tif (typeof val == 'boolean') {\n\t\t\t\t\tval = val ? 1 : 0;\n\t\t\t\t}\n\t\t\t\tel.appendChild(ds_doc.createTextNode(val));\n\t\t\t}\n\t\t}\n\t\tstr = new XMLSerializer().serializeToString(ds_doc);\n\t\treturn str;\n\t});\n\n\tvar startxref = out.position();\n\tif (doc.xref_type === 'table') {\n\t\tobjects.write_xref_table(out, doc.startXRef, root_ref);\n\t} else {\n\t\tobjects.write_xref_stream(out, doc.startXRef, root_ref);\n\t}\n\n\tout.write_str('\\nstartxref\\n');\n\tout.write_str(startxref + '\\n');\n\tout.write_str('%%EOF');\n\n\treturn out.get_uint8array();\n}\n\nfunction list_fields(data) {\n\tvar doc = minipdf_lib.parse(new Uint8Array(data));\n\tvar res = {};\n\n\tvisit_acroform_fields(doc, function(n) {\n\t\tvar raw_name = pdf_decode_str(n.map.T);\n\t\tvar name = raw_name;\n\t\tvar index = 0;\n\t\tvar m = /^(.+?)\\[([0-9]+)\\]$/.exec(raw_name);\n\t\tif (m) {\n\t\t\tname = m[1];\n\t\t\tindex = parseInt(m[2], 10);\n\t\t}\n\n\t\tvar spec;\n\t\tif (n._pdfform_spec) {\n\t\t\tspec = n._pdfform_spec;\n\t\t} else {\n\t\t\tvar ft_name = n.map.FT.name;\n\t\t\tif (ft_name === 'Tx') {\n\t\t\t\tspec = {type: 'string'};\n\t\t\t} else if (ft_name === 'Btn') {\n\t\t\t\tspec = {type: 'boolean'};\n\t\t\t} else if (ft_name === 'Ch') {\n\t\t\t\tspec = {\n\t\t\t\t\ttype: 'select',\n\t\t\t\t\toptions: n.map.Opt.slice(),\n\t\t\t\t};\n\t\t\t} else if (ft_name === 'Sig') {\n\t\t\t\treturn; // Signature names are not supported so far\n\t\t\t} else {\n\t\t\t\tthrow new Error('Unsupported input type' + ft_name);\n\t\t\t}\n\t\t}\n\n\t\tif (!res[name]) {\n\t\t\tres[name] = [];\n\t\t}\n\t\tres[name][index] = spec;\n\t});\n\n\treturn res;\n}\n\nreturn {\n\ttransform: transform,\n\tlist_fields: list_fields,\n\t// test only\n\t_serialize_str: serialize_str,\n\t_decode_str: pdf_decode_str,\n};\n}\n\n// Backwards compatibility only\npdfform.transform = function(buf, fields) {return pdfform().transform(buf, fields);};\n\nif (typeof module != 'undefined') {\n\tmodule.exports = pdfform;\n}"]},"metadata":{},"sourceType":"script"}